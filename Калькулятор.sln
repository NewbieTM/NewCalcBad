using System;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;
using System.Globalization;
using System.Collections.Generic;

namespace Калькулятор
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            button17.Location = new Point(200, 60);
            button20.Location = new Point(200, 289);
            foreach (Button buttones in panel2.Controls.OfType<Button>())
            {
                buttones.Click += (s, a) =>
                {
                    if (h > 0)
                    {
                        forCompute += buttones.Text;
                        count++;
                        label1.Text += $"{buttones.Text}";
                        r++;
                        str.Add(forCompute);
                        forCompute = "";
                    }
                    else
                    {
                        count++;
                        label1.Text += $"{buttones.Text}";
                        
                    }
                    
                };
            }
            button18.Click += (s, e) =>
            {
                if (label1.Text.Length >= 1)
                {
                    if(char.IsDigit(label1.Text.Last()))
                    {
                        label1.Text += '*';
                    }
                    count++;
                   
                }
            };
            foreach (Button buttonnn in panel3.Controls.OfType<Button>())
            {
                buttonnn.Click += (s, a) =>
                {
                    h = 0;
                        if (count >= 1)
                        {
                            label1.Text += $"{buttonnn.Text}";
                            count2++;
                            
                        }
                        if (count2 >= 1)
                        {
                            count = 0;
                        }
                };
            }
            button19.Click += (s, e) =>
            {
                count++;
                
            };
            button17.Click += (s, a) =>
            {
                label1.Text = null;
                r = 0;
            };
            button15.Click += (s, a) =>
            {
                label1.Text += button15.Text;
                
            };
            button21.Click += (s, a) =>
            {
                if (label1.Text.Length >= 1)
                {
                    char[] arr = label1.Text.ToCharArray();
                    int length2 = label1.Text.Length - 1;
                    label1.Text = label1.Text.Replace(arr[length2], '\0');
                }
            };
        }
        DataTable dataTable = new DataTable(); //Здесь лучше один раз создать объект и его использовать
        private void button14_Click(object sender, EventArgs e)
        {
            count++;
            label1.Text += $"{button14.Text}";
            
        }
        public int count = 0;
        public int count2 = 0;
        public int length = 0;
        public List<string> str = new List<string>();
        
        NumberFormatInfo numberFormatInfo = new NumberFormatInfo //региональные настройки
        {
            NumberDecimalSeparator = "."
        };
        
        private void button20_Click(object sender, EventArgs e)
        {
            try
            {
                if (label1.Text.Length >= 1)
                {
                    double value = double.Parse(label1.Text, numberFormatInfo);
                    value /= 100;
                    label1.Text = value.ToString(numberFormatInfo);
                }
            }
            catch (Exception)
            {
 
            }
        }
        private void button2_Click(object sender, EventArgs e)
        {
            if (label1.Text == "")
            {

            }
            else if (label1.Text.Contains("@") & label1.Text.Length > 0)
            {
                string lines = str.ToString();
                string zxc = forCompute.Substring(0).Replace("@", "");
                float result = (float)Math.Sqrt(Convert.ToDouble(zxc));
                double re = Math.Round(result, 5);
                string strin = label1.Text.Replace($"{forCompute}", "");
                if (strin.Contains("@"))
                {
                    string a = strin.Replace("@","");
                    string res222 = re + a;
                    var res2 = Convert.ToDouble(dataTable.Compute(res222, null));
                    label1.Text = res2.ToString(numberFormatInfo);
                }
                string st = strin.Replace("@", "");
                string res = re.ToString(numberFormatInfo) + st;
                if (st != "")
                {
                    var res2 = Convert.ToDouble(dataTable.Compute(res, null));
                    label1.Text = res2.ToString(numberFormatInfo);
                }
                else
                {
                    label1.Text = result.ToString();
                }
            }
            else if (label1.Text.Contains("~"))
            {
                
            }
            else if (!label1.Text.Contains("@") || !label1.Text.Contains("~"))
            {
               string str = label1.Text;
               double res = Convert.ToDouble(dataTable.Compute(str, null));
               label1.Text = res.ToString(numberFormatInfo);
            }
        }
        public int r = 0;
        public string forCompute = "";
        public int h = 0;
        private void button23_Click(object sender, EventArgs e)
        {
            h++;
            label1.Text += "@";
            
        }

        private void button22_Click(object sender, EventArgs e)
        {
            h++;
            label1.Text += "~";
        }
    }
}
